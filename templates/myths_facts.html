{% extends "base.html" %} {% block title %}Myths vs Facts - Mental Health{%
endblock %} {% block content %}
<div class="container mt-4">
	<div class="row">
		<div class="col-12">
			<div class="text-center mb-5">
				<h1 class="display-4 text-primary mb-3">
					<i class="fas fa-lightbulb"></i> Myths vs Facts
				</h1>
				<p class="lead text-muted">
					Separating truth from fiction about mental health
				</p>
				<p class="text-muted">
					Understanding the facts can help reduce stigma and encourage people to
					seek help when needed.
				</p>
			</div>
		</div>
	</div>

	<!-- Search and Filter Section -->
	<div class="row mb-4">
		<div class="col-12">
			<div class="card shadow-sm">
				<div class="card-body">
					<div class="row g-3">
						<div class="col-md-6">
							<div class="input-group">
								<span class="input-group-text"
									><i class="fas fa-search"></i
								></span>
								<input
									type="text"
									class="form-control"
									id="searchInput"
									placeholder="Search myths and facts..."
								/>
							</div>
						</div>
						<div class="col-md-3">
							<select class="form-select" id="categoryFilter">
								<option value="">All Categories</option>
								<option value="mental_health">General Mental Health</option>
								<option value="depression">Depression</option>
								<option value="anxiety">Anxiety</option>
								<option value="student">Student Life</option>
							</select>
						</div>
						<div class="col-md-3">
							<select class="form-select" id="languageFilter">
								<option value="en">English</option>
								<option value="hi">हिंदी</option>
							</select>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Random Myth/Fact Card -->
	<div class="row mb-4">
		<div class="col-12">
			<div class="card shadow-sm border-primary">
				<div class="card-header bg-primary text-white">
					<div class="d-flex justify-content-between align-items-center">
						<h5 class="mb-0">
							<i class="fas fa-random"></i> Random Myth Buster
						</h5>
						<button class="btn btn-light btn-sm" id="randomBtn">
							<i class="fas fa-dice"></i> Get Another
						</button>
					</div>
				</div>
				<div class="card-body" id="randomMythFact">
					<div class="text-center">
						<div class="spinner-border text-primary" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Myths and Facts Grid -->
	<div class="row">
		<div class="col-12">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<h3 class="mb-0">Explore All Myths & Facts</h3>
				<div class="btn-group" role="group">
					<input
						type="radio"
						class="btn-check"
						name="viewMode"
						id="cardView"
						autocomplete="off"
						checked
					/>
					<label class="btn btn-outline-primary btn-sm" for="cardView">
						<i class="fas fa-th"></i> Cards
					</label>
					<input
						type="radio"
						class="btn-check"
						name="viewMode"
						id="listView"
						autocomplete="off"
					/>
					<label class="btn btn-outline-primary btn-sm" for="listView">
						<i class="fas fa-list"></i> List
					</label>
				</div>
			</div>

			<div id="mythsFactsContainer">
				<div class="text-center">
					<div class="spinner-border text-primary" role="status">
						<span class="visually-hidden">Loading...</span>
					</div>
				</div>
			</div>

			<!-- Load More Button -->
			<div
				class="text-center mt-4"
				id="loadMoreContainer"
				style="display: none"
			>
				<button class="btn btn-primary" id="loadMoreBtn">
					<i class="fas fa-plus"></i> Load More
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Myth/Fact Detail Modal -->
<div class="modal fade" id="mythFactModal" tabindex="-1">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">
					<i class="fas fa-info-circle text-primary"></i>
					<span id="modalTitle">Myth vs Fact</span>
				</h5>
				<button
					type="button"
					class="btn-close"
					data-bs-dismiss="modal"
				></button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-md-6">
						<div class="card border-danger h-100">
							<div class="card-header bg-danger text-white">
								<h6 class="mb-0"><i class="fas fa-times-circle"></i> Myth</h6>
							</div>
							<div class="card-body">
								<p class="mb-0" id="modalMyth"></p>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="card border-success h-100">
							<div class="card-header bg-success text-white">
								<h6 class="mb-0"><i class="fas fa-check-circle"></i> Fact</h6>
							</div>
							<div class="card-body">
								<p class="mb-0" id="modalFact"></p>
							</div>
						</div>
					</div>
				</div>
				<div class="mt-3">
					<small class="text-muted">
						<i class="fas fa-tag"></i>
						Category:
						<span id="modalCategory" class="badge bg-secondary"></span>
					</small>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
					Close
				</button>
				<button type="button" class="btn btn-primary" id="shareBtn">
					<i class="fas fa-share"></i> Share
				</button>
			</div>
		</div>
	</div>
</div>
{% endblock %} {% block scripts %}
<script>
	let currentPage = 1;
	let currentCategory = "";
	let currentLanguage = "en";
	let isLoading = false;

	document.addEventListener("DOMContentLoaded", function () {
		loadRandomMythFact();
		loadMythsFacts();

		// Event listeners
		document
			.getElementById("searchInput")
			.addEventListener("input", debounce(handleSearch, 500));
		document
			.getElementById("categoryFilter")
			.addEventListener("change", handleFilterChange);
		document
			.getElementById("languageFilter")
			.addEventListener("change", handleFilterChange);
		document
			.getElementById("randomBtn")
			.addEventListener("click", loadRandomMythFact);
		document
			.getElementById("loadMoreBtn")
			.addEventListener("click", loadMoreMythsFacts);

		// View mode toggle
		document.querySelectorAll('input[name="viewMode"]').forEach((radio) => {
			radio.addEventListener("change", handleViewModeChange);
		});
	});

	// Debounce function for search
	function debounce(func, wait) {
		let timeout;
		return function executedFunction(...args) {
			const later = () => {
				clearTimeout(timeout);
				func(...args);
			};
			clearTimeout(timeout);
			timeout = setTimeout(later, wait);
		};
	}

	// Load random myth/fact
	function loadRandomMythFact() {
		const language = document.getElementById("languageFilter").value;
		fetch(`/api/myths-facts/random?language=${language}`)
			.then((response) => response.json())
			.then((data) => {
				if (data.myth_fact) {
					displayRandomMythFact(data.myth_fact);
				}
			})
			.catch((error) =>
				console.error("Error loading random myth/fact:", error)
			);
	}

	// Display random myth/fact
	function displayRandomMythFact(mythFact) {
		const container = document.getElementById("randomMythFact");
		container.innerHTML = `
        <div class="row">
            <div class="col-md-6">
                <div class="card border-danger h-100">
                    <div class="card-header bg-danger text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-times-circle"></i> Myth
                        </h6>
                    </div>
                    <div class="card-body">
                        <p class="mb-0">${mythFact.myth}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-success h-100">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-check-circle"></i> Fact
                        </h6>
                    </div>
                    <div class="card-body">
                        <p class="mb-0">${mythFact.fact}</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-3 text-end">
            <small class="text-muted">
                <i class="fas fa-tag"></i>
                Category: <span class="badge bg-secondary">${
									mythFact.category || "General"
								}</span>
            </small>
        </div>
    `;
	}

	// Load myths and facts
	function loadMythsFacts(reset = true) {
		if (isLoading) return;

		isLoading = true;
		if (reset) {
			currentPage = 1;
			document.getElementById("mythsFactsContainer").innerHTML = `
            <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        `;
		}

		const category = document.getElementById("categoryFilter").value;
		const language = document.getElementById("languageFilter").value;
		const searchQuery = document.getElementById("searchInput").value;

		let url = `/api/myths-facts?language=${language}&limit=12&page=${currentPage}`;
		if (category) url += `&category=${category}`;
		if (searchQuery)
			url = `/api/myths-facts/search?q=${encodeURIComponent(
				searchQuery
			)}&language=${language}`;

		fetch(url)
			.then((response) => response.json())
			.then((data) => {
				const mythsFacts = searchQuery ? data.results : data.myths_facts;
				if (reset) {
					displayMythsFacts(mythsFacts, reset);
				} else {
					appendMythsFacts(mythsFacts);
				}

				// Show/hide load more button
				const loadMoreContainer = document.getElementById("loadMoreContainer");
				if (mythsFacts.length === 12 && !searchQuery) {
					loadMoreContainer.style.display = "block";
				} else {
					loadMoreContainer.style.display = "none";
				}
			})
			.catch((error) => {
				console.error("Error loading myths/facts:", error);
				document.getElementById("mythsFactsContainer").innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle"></i>
                    Error loading content. Please try again.
                </div>
            `;
			})
			.finally(() => {
				isLoading = false;
			});
	}

	// Display myths and facts
	function displayMythsFacts(mythsFacts, reset = true) {
		const container = document.getElementById("mythsFactsContainer");

		if (reset) {
			container.innerHTML = "";
		}

		if (mythsFacts.length === 0) {
			container.innerHTML = `
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                No myths and facts found matching your criteria.
            </div>
        `;
			return;
		}

		const isCardView = document.getElementById("cardView").checked;
		const row = document.createElement("div");
		row.className = "row g-4";

		mythsFacts.forEach((mythFact) => {
			const col = document.createElement("div");
			col.className = isCardView ? "col-md-6 col-lg-4" : "col-12";

			col.innerHTML = createMythFactCard(mythFact, isCardView);
			row.appendChild(col);
		});

		container.appendChild(row);
	}

	// Append more myths and facts
	function appendMythsFacts(mythsFacts) {
		const container = document.getElementById("mythsFactsContainer");
		const existingRow = container.querySelector(".row");

		if (!existingRow) {
			displayMythsFacts(mythsFacts, false);
			return;
		}

		const isCardView = document.getElementById("cardView").checked;

		mythsFacts.forEach((mythFact) => {
			const col = document.createElement("div");
			col.className = isCardView ? "col-md-6 col-lg-4" : "col-12";
			col.innerHTML = createMythFactCard(mythFact, isCardView);
			existingRow.appendChild(col);
		});
	}

	// Create myth/fact card
	function createMythFactCard(mythFact, isCardView) {
		if (isCardView) {
			return `
            <div class="card h-100 shadow-sm myth-fact-card" onclick="showMythFactModal('${mythFact.myth.replace(
							/'/g,
							"\\'"
						)}', '${mythFact.fact.replace(/'/g, "\\'")}', '${
				mythFact.category || "General"
			}')">
                <div class="card-body">
                    <div class="row h-100">
                        <div class="col-6">
                            <div class="text-center h-100 d-flex flex-column justify-content-center border-end">
                                <div class="text-danger mb-2">
                                    <i class="fas fa-times-circle fa-2x"></i>
                                </div>
                                <h6 class="text-danger">Myth</h6>
                                <p class="small text-muted">${mythFact.myth.substring(
																	0,
																	80
																)}${mythFact.myth.length > 80 ? "..." : ""}</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center h-100 d-flex flex-column justify-content-center">
                                <div class="text-success mb-2">
                                    <i class="fas fa-check-circle fa-2x"></i>
                                </div>
                                <h6 class="text-success">Fact</h6>
                                <p class="small text-muted">${mythFact.fact.substring(
																	0,
																	80
																)}${mythFact.fact.length > 80 ? "..." : ""}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-light">
                    <small class="text-muted">
                        <i class="fas fa-tag"></i> ${
													mythFact.category || "General"
												}
                    </small>
                </div>
            </div>
        `;
		} else {
			return `
            <div class="card shadow-sm myth-fact-card mb-3" onclick="showMythFactModal('${mythFact.myth.replace(
							/'/g,
							"\\'"
						)}', '${mythFact.fact.replace(/'/g, "\\'")}', '${
				mythFact.category || "General"
			}')">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="d-flex align-items-start">
                                <div class="text-danger me-3 mt-1">
                                    <i class="fas fa-times-circle"></i>
                                </div>
                                <div>
                                    <h6 class="text-danger mb-2">Myth</h6>
                                    <p class="mb-0">${mythFact.myth}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-1 text-center d-none d-md-block">
                            <div class="vr h-100"></div>
                        </div>
                        <div class="col-md-5">
                            <div class="d-flex align-items-start">
                                <div class="text-success me-3 mt-1">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div>
                                    <h6 class="text-success mb-2">Fact</h6>
                                    <p class="mb-0">${mythFact.fact}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-1 text-end d-none d-md-block">
                            <small class="text-muted">
                                <i class="fas fa-tag"></i><br>
                                ${mythFact.category || "General"}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        `;
		}
	}

	// Show myth/fact modal
	function showMythFactModal(myth, fact, category) {
		document.getElementById("modalMyth").textContent = myth;
		document.getElementById("modalFact").textContent = fact;
		document.getElementById("modalCategory").textContent = category;

		const modal = new bootstrap.Modal(document.getElementById("mythFactModal"));
		modal.show();
	}

	// Handle search
	function handleSearch() {
		loadMythsFacts(true);
	}

	// Handle filter change
	function handleFilterChange() {
		loadMythsFacts(true);
		loadRandomMythFact();
	}

	// Handle view mode change
	function handleViewModeChange() {
		loadMythsFacts(true);
	}

	// Load more myths/facts
	function loadMoreMythsFacts() {
		currentPage++;
		loadMythsFacts(false);
	}

	// Share functionality
	document.getElementById("shareBtn").addEventListener("click", function () {
		const myth = document.getElementById("modalMyth").textContent;
		const fact = document.getElementById("modalFact").textContent;

		if (navigator.share) {
			navigator.share({
				title: "Mental Health Myth vs Fact",
				text: `Myth: ${myth}\n\nFact: ${fact}`,
				url: window.location.href,
			});
		} else {
			// Fallback: copy to clipboard
			const text = `Myth: ${myth}\n\nFact: ${fact}\n\nShared from: ${window.location.href}`;
			navigator.clipboard.writeText(text).then(() => {
				alert("Content copied to clipboard!");
			});
		}
	});
</script>
{% endblock %}
